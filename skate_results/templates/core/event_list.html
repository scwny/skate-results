{% extends 'base.html' %}
{% block title %}Events – {{ competition.name }}{% endblock %}
{% block competition_name %}{{ competition.name }}{% endblock %}

{% block content %}
<style>
  .btn-equal {
    /* adjust to whatever width you need */
    min-width: 100px;
    width: 100px;
  }
</style>


<!-- Collapsible Filter Box -->
<div class="accordion mb-4" id="filterAccordion">
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingFilter">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFilter" aria-expanded="false" aria-controls="collapseFilter">
        Filter Events
      </button>
    </h2>
    <div id="collapseFilter" class="accordion-collapse collapse" aria-labelledby="headingFilter" data-bs-parent="#filterAccordion">
      <div class="accordion-body">
        <form method="get" class="row g-3">
          <div class="col-md-4">
            <label for="event_name" class="form-label">Event Name</label>
            <input type="text" id="event_name" name="event_name" class="form-control" value="{{ filters.event_name }}">
          </div>
          <div class="col-md-4">
            <label for="skater_name" class="form-label">Skater Name</label>
            <input type="text" id="skater_name" name="skater_name" class="form-control" value="{{ filters.skater_name }}">
          </div>
          <div class="col-md-4">
            <label for="club_name" class="form-label">Club Name</label>
            <select id="club_name" name="club_name" class="form-select">
              <option value="">(Any Club)</option>
              {% for name in clubs %}
                <option value="{{ name }}"{% if filters.club_name == name %} selected{% endif %}>
                  {{ name }}
                </option>
              {% endfor %}
            </select>
          </div>
          <div class="col-12 text-end">
            <button type="submit" class="btn btn-primary">Apply Filters</button>
            <a href="{% url 'competition_events' competition.pk %}" class="btn btn-outline-secondary">Reset</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

{% if filters.event_name or filters.skater_name or filters.club_name %}
  <div class="mb-3 d-flex flex-wrap align-items-center gap-2">

    {% if filters.event_name %}
      <a href="?{% if filters.skater_name %}skater_name={{ filters.skater_name }}&{% endif %}{% if filters.club_name %}club_name={{ filters.club_name }}&{% endif %}"
         class="badge bg-primary text-decoration-none">
        Event: {{ filters.event_name }} ✕
      </a>
    {% endif %}

    {% if filters.skater_name %}
      <a href="?{% if filters.event_name %}event_name={{ filters.event_name }}&{% endif %}{% if filters.club_name %}club_name={{ filters.club_name }}&{% endif %}"
         class="badge bg-primary text-decoration-none">
        Skater: {{ filters.skater_name }} ✕
      </a>
    {% endif %}

    {% if filters.club_name %}
      <a href="?{% if filters.event_name %}event_name={{ filters.event_name }}&{% endif %}{% if filters.skater_name %}skater_name={{ filters.skater_name }}&{% endif %}"
         class="badge bg-primary text-decoration-none">
        Club: {{ filters.club_name }} ✕
      </a>
    {% endif %}

    <!-- Clear All Button -->
    <a href="{% url 'competition_events' competition.pk %}" class="btn btn-sm btn-outline-secondary ms-auto">
      Clear All Filters
    </a>
  </div>
{% endif %}

<!-- Event List -->
<ul class="list-group">
  {% for event in events %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div>{{ event.eventNumber }} - {{ event.name }}</div>
      <div>
      {% if event.status != 'finished' %}
        <a href="{% url 'event_schedule' event.pk %}" class="btn btn-primary btn-sm btn-equal me-2">
          Schedule
        </a>
      {% else %}
         <a href="{% url 'event_results' event.pk %}"  class="btn btn-sm btn-equal 
         {% if event.status == 'finished' and event.result_image %}
           btn-success
         {% else %}
          btn-outline-danger
         {% endif %} me-2">
           Results
         </a>
      {% endif %}
    </div>
  {% empty %}
    <li class="list-group-item">No events scheduled.</li>
  {% endfor %}
</ul>

<div class="mb-3" style='margin-top: 25px;'>
  <a href="{% url 'competition_list' %}" class="btn btn-secondary">
    &larr; Back to Competitions
  </a>
</div>

{% endblock %}